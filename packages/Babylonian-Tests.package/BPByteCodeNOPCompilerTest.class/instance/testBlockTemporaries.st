enabled-tests
testBlockTemporaries
	
	| method expected byteCode |
	method := BPByteCodeRewriter instrumentString: 'simple
	| t1 t2 t3 t4 | 
	[
		t3. t4.
		[]. 
	]. 
	[
		t1
	]'.
	self assertLiterals: method.
	BPByteCodeRewriter enableTracingForCompiledMethod: method.

	byteCode := method abstractSymbolic withBlanksTrimmed.
	expected := '
	...
	storeIntoTemp: 4
	...
	pushTemp: 4
	...
	pushTemp: 4
	closureNumCopied: 3 numArgs: 0 size: ...
		...
		pushTemp: 2
		...
		pushTemp: 2
		closureNumCopied: 1 numArgs: 0 size: ...
			...
			pushTemp: 0
			...
			pushTemp: 0
			...
		pushTemp: 2
		...
		pop
		...
	pop
	...
	pushTemp: 4
	closureNumCopied: 2 numArgs: 0 size: ...
		...
		pushTemp: 1
		...
		pushTemp: 1
		...
	pop
	...
	pushTemp: 4
	...' withBlanksTrimmed.
	
	expected := (expected 
		copyReplaceAll: ':' with: '\:')
		copyReplaceAll: '...' with: '.*'.
	
	self assert: (byteCode matchesRegex: expected)