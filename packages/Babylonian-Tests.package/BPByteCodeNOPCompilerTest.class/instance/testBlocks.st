enabled-tests
testBlocks
	
	| method byteCode expected |

	method := BPByteCodeRewriter instrumentString: 'simple \ [10. [20]. 30]. [40]'  withCRs.
	self assertLiterals: method.
	BPByteCodeRewriter enableTracingForCompiledMethod: method.

	byteCode := method abstractSymbolic withBlanksTrimmed.
	expected := '
	...
	storeIntoTemp: 0
	...
	pushTemp: 0
	...
	pushTemp: 0
	closureNumCopied: 1 numArgs: 0 size: ...
		pushTemp: 0
		...
		pushTemp: 0
		closureNumCopied: 1 numArgs: 0 size: ...
			pushTemp: 0
			...
			pushTemp: 0
			...
			blockReturn
		...
		pushTemp: 0
		...
		blockReturn
	...
	pushTemp: 0
	closureNumCopied: 1 numArgs: 0 size: ...
		...
		pushTemp: 0
		...
		pushTemp: 0
		...
		blockReturn
	...
	pushTemp: 0
	...
	returnSelf' withBlanksTrimmed.

	expected := (expected 
		copyReplaceAll: ':' with: '\:')
		copyReplaceAll: '...' with: '.*'.

	self assert: (byteCode matchesRegex: expected)